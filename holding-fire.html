<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/firebase-document.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<!--
`holding-fire`

Example:
```
<firebase-app
    name="demo"
    api-key="API_KEY"
    auth-domain="AUTH_DOMAIN"
    database-url="DATABASE_URL"
></firebase-app>
<holding-fire 
    app-name="demo"
    path="users/"
    logo="images/logo.png"
    text="Website coming soon! Subscribe to find out when we launch!"
    email="hello@convoo.me"
></holding-fire>
```

### Styling

Style the element with CSS as you would a normal DOM element. 

The following custom properties and mixins are available for styling:

| Custom property | Description | Default |
| --- | --- | --- |
| `--holding-fire-input-color` | The color for the input | `white` |
| `--holding-fire-background` | Mixin for the background | `{}` |
| `--holding-fire-overlay` | Mixin for the overlay  | `{}` |
| `--holding-fire-container` | Mixin ofr the container | `{}` |
| `--holding-fire-logo` | Mixin for the logo | `{}` |
| `--holding-fire-email-text` | Mixin for the email text | `{}` |
| `--holding-fire-email-text` | Mixin for the email text | `{}` |
| `--holding-fire-welcome-text` | Mixin for the welcome text | `{}` |
| `--holding-fire-input` | Mixin for the input | `{}` |
| `--holding-fire-subscribe-button` | Mixin for the subscribe button | `{}` |
| `--holding-fire-twitter-button` | Mixin for the twitter button | `{}` |
| `---holding-fire-subscribe-container` | Mixin for the subscribe container| `{}` |
| `--holding-fire-twitter-container` | Mixin for the Twitter container | `{}` |
| `--holding-fire-show-thankyou` | Mixin for revealing the thank you container | `{}` |

@demo demo/index.html 
-->

<dom-module id="holding-fire">
  <template>
      
    <style>
    :host {
        display: block;
        position: absolute;
        left: 0px;
        bottom: 0px;
        right: 0px;
        top: 0px;
        overflow:none 
        @apply(--layout-horizontal);
        @apply(--layout-center); 
    }
    .background{     
        position: absolute;
        left: 0px;
        bottom: 0px;
        right: 0px;
        top: 0px;
        @apply(--holding-fire-background);
        display: none;
    }
    .overlay{
        position: absolute;
        left: 0px;
        bottom: 0px;
        right: 0px;
        top: 0px;
        z-index: 200;
        @apply(--holding-fire-overlay);
        display: none;
    }
    .container{
        z-index: 400;
        @apply(--holding-fire-container); 
    }
    .welcome-text{
        z-index: 400;
        @apply(--holding-fire-welcome-text); 
    }
    .thankyou-text{
        z-index: 400;
        @apply(--holding-fire-thankyou-text); 
    }
    .email a{
        @apply(--holding-fire-email-text); 
    }

    paper-button.subscribe {
        z-index: 400;
        @apply(--holding-fire-subscribe-button); 
    }
    paper-button.twitter {
        z-index: 400;
        @apply(--holding-fire-twitter-button); 
    }
    paper-input.custom {
        --paper-input-container-color: var(--holding-fire-input-color, white);
        --paper-input-container-focus-color: var(--holding-fire-input-color, white);
        --paper-input-container-invalid-color: var(--holding-fire-input-color, white);
        --paper-input-container-input-color: var(--holding-fire-input-color, white);
        z-index: 400;
        @apply(--holding-fire-input); 
    }
    .subscribe-form{
        z-index: 400;
        @apply(--holding-fire-subscribe-container); 
    }
    .twitter-form{
        z-index: 400;
        @apply(--holding-fire-twitter-container); 
    }
    .logo{
        @apply(--holding-fire-logo); 
    }
    .show-thanks{
        @apply(--holding-fire-show-thankyou); 
    }
    .cant-select {
        -webkit-touch-callout: none; 
        -webkit-user-select: none; 
        -khtml-user-select: none; 
        -moz-user-select: none; 
        -ms-user-select: none; 
        user-select: none; 
    }
    @keyframes fade {
        0% {
            opacity: 0;
        }
        100% {
            opacity: 1;
        }
    }
    @keyframes zoom {
        0% {
            transform: scale(1);
        }
        100% {
            transform: scale(1.1);
        }
    }
    </style>

    <firebase-document
        id="doc"
        app-name="[[appName]]"
        path="[[path]]"
        data="{{data}}">
    </firebase-document>

    <div class="background"></div>
    <div class="overlay"></div>
    <div class="container">
        <iron-image src="[[logo]]" class="logo" sizing="contain" alt="[[alt]]]"></iron-image></br>
        <template is="dom-if" if="{{!subscribed}}" class="hidden"> 
            <h2 class="welcome-text cant-select">[[text]]</h2>
            <form class="subscribe-form">
                <paper-input label="Email:" class="custom" id="email"></paper-input></br>            
                <paper-button toggles raised class="subscribe" on-tap="subscribe">Subscribe</paper-button>
            </form>
        </template>

        <template is="dom-if" if="{{subscribed}}"> 
            <div hidden="{{!subscribed}}" class="show-thanks">
                <h2 class="thankyou-text cant-select">[[thanks]]</h2>
                <form class="twitter-form">
                    <template is="dom-if" if="{{twitter}}">        
                        <paper-button toggles raised class="twitter" on-tap="_twitter">
                            <svg viewBox="0 0 20.34 16.17" style="height:15px;fill:#FFF; padding-left: 10px; padding-right: 10px">
                            <path class="515a544b-2ee6-4052-8329-f9002443fb0f" d="M7,16.61A11.39,11.39,0,0,0,18.43,5.14q0-.26,0-0.52a8.2,8.2,0,0,0,2-2.09,8,8,0,0,1-2.31.63A4,4,0,0,0,19.89.94a8.08,8.08,0,0,1-2.56,1,4,4,0,0,0-6.87,3.68A11.44,11.44,0,0,1,2.15,1.38,4,4,0,0,0,3.4,6.76a4,4,0,0,1-1.83-.5s0,0,0,.05a4,4,0,0,0,3.23,4A4,4,0,0,1,3,10.33a4,4,0,0,0,3.77,2.8,8.09,8.09,0,0,1-5,1.73,8.19,8.19,0,0,1-1-.06A11.41,11.41,0,0,0,7,16.61" transform="translate(-0.36 -0.55)"/>
                            </svg>Follow us on Twitter
                        </paper-button>
                    </template>
                </form>
            </div>
        </template>
        <p class="email"><a href="mailto:[[email]]">[[email]]</a></p>
    </div>
</template>

  <script>
    Polymer({
    is: 'holding-fire',
    properties: {
        /**
        * Link to the image file for the logo
        *
        * @type {String}
        */
        logo: {
          type: String,
        },
        /**
        * Text to be displayed below the logo
        *
        * @type {String}
        */
        text: {
          type: String,
        },
        /**
        * Text to be displayed to thank the user
        *
        * @type {String}
        */
        thanks: {
          type: String,
        },
        /**
        * Email to be displayed below the subscription form 
        *
        * @type {String}
        */
        email: {
          type: String,
        },
        /**
        * The name of the firebase app
        *
        * @type {String}
        */
        appName: {
          type: String,
        },
        /**
        * The storage path for the subscription emails 
        *
        * @type {String}
        */
        path: {
          type: String,
        },
        /**
        * Indicates if the user has subscribed 
        *
        * @type {Boolean}
        */
        subscribed: {
            type: Boolean,
            value: false,
        },
        /**
        * Alt text for the logo
        *
        * @type {String}
        */
        alt: {
            type: String,
        },
      },

    subscribe: function(){
        var date = new Date();
        var epoch = date.getTime();
        if(this._validateEmail(this.$$("#email").value)){
            this.$.doc.ref.push({email: this.$$("#email").value, date: epoch});  
            this.subscribed = true;
        }
    },

    _validateEmail: function(email) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    },

    _twitter: function(){
        window.location = "http://www.twitter.com/[[twitter]]";
    }

    });
  </script>
</dom-module>
