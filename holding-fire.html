<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../polymerfire/firebase-document.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<!--
`holding-fire`

Example:
```
<firebase-app
    name="demo"
    api-key="API_KEY"
    auth-domain="AUTH_DOMAIN"
    database-url="DATABASE_URL"
></firebase-app>
<holding-fire 
    app-name="demo"
    path="users/"
    logo="images/logo.png"
    text="Website coming soon! Subscribe to find out when we launch!"
    email="hello@convoo.me"
></holding-fire>
```

### Styling

Style the element with CSS as you would a normal DOM element. 

The following custom properties and mixins are available for styling:

| Custom property | Description |
| --- | --- |
| `--holding-fire-host` | Mixin for the host element |
| `--holding-fire-overlay` | Mixin for an overlay |
| `--holding-fire-container` | Mixin for the container |
| `--holding-fire-logo` | Mixin for the logo |
| `--holding-fire-inner-container` | Mixin for the inner container with content and form |
| `--holding-fire-content` | Mixin for the content section |
| `---holding-fire-subscribe-container` | Mixin for the subscribe container|
| `---holding-fire-subscribe-title` | Mixin for the subscribe title|
| `---holding-fire-subscribe-form` | Mixin for the subscribe form|
| `--holding-fire-input` | Mixin for the inputs |
| `---holding-fire-subscribe-button` | Mixin for the subscribe button|
| `--holding-fire-email` | Mixin for the email paragraph |
| `--holding-fire-email-link` | Mixin for the email text |
| `---holding-fire-thanks-container` | Mixin for the thanks container|
| `---holding-fire-thanks-title` | Mixin for the thanks title|
| `---holding-fire-thanks-section` | Mixin for the thanks section|
| `--holding-fire-twitter-link` | Mixin for the twitter link |
| `--holding-fire-twitter-button` | Mixin for the twitter button |
| `--holding-fire-animations` | Mixin for any animations you want to define. First one will not be registered. See demo. |

@demo demo/index.html 
-->

<dom-module id="holding-fire">
  <template>
    <style>
    :host {
        display: block;
        padding: var(--mobile-border, 50px);
        @apply(--layout-center);
        background: #000;
        background-repeat: no-repeat;
        background-size: cover;
        @apply(--holding-fire-host);
    }

        .overlay{
            @apply(--holding-fire-overlay);
        }

        .container{
            display: block;
            overflow: hidden;
            max-width: 960px;
            text-align: center;
            margin: auto;
            padding: 20px;
            z-index: 400;
            opacity: 1;
            background: white;
            @apply(--holding-fire-container); 
        }

            .logo{
                max-width: 200px;
                margin: 20px auto;
                padding-bottom: 30px;
                @apply(--holding-fire-logo); 
            }

            .inner-container{
                /*@apply(--layout-horizontal);
                @apply(--layout-wrap);*/

                @apply(--layout-vertical);
                @apply(--holding-fire-inner-container);
            }

                .content{
                    color: #000000;
                    text-align: center;
                    margin: auto;
                    padding: 20px;
                    min-width: 280px;
                    max-width: 500px;
                    @apply(--holding-fire-content);
                }

                .subscribe-container{
                    min-width: 280px;
                    margin: auto;
                    text-align: left;
                    @apply(--holding-fire-subscribe-container);
                }

                    .subscribe-title{
                        padding:20px;
                        padding-left:30px;
                        @apply(--holding-fire-subscribe-title); 
                    }

                    .subscribe-form{
                        padding-top: 20px;
                        padding-left: 35px;
                        padding-right: 40px;
                        padding-bottom: 5px;
                        @apply(--holding-fire-subscribe-form);
                    }
                    
                    paper-input.custom {
                        z-index: 400;
                        text-align: left;
                        --paper-input-container-color: var(--holding-fire-input-container-color);
                        --paper-input-container-focus-color: var(--holding-fire-input-container-focus-color);
                        --paper-input-container-invalid-color: var(--holding-fire-input-invalid-color);
                        --paper-input-container-input-color: var(--holding-fire-input-color);
                        @apply(--holding-fire-input); 
                    }

                    paper-button.subscribe {
                        z-index: 400;
                        width: 100%;
                        @apply(--holding-fire-subscribe-button); 
                    }

                    .email {
                        text-align: center;
                        @apply(--holding-fire-email); 
                    }

                    .email a{
                        opacity: 0.32;
                        font-size: 11px;
                        color: #000000;
                        text-align: center;
                        text-decoration:none;
                        @apply(--holding-fire-email-link);
                    }
                
                .thanks-container{
                    min-width: 280px;
                    margin: auto;
                    text-align: left;
                    @apply(--holding-fire-thanks-container);
                }

                    .thanks-title{
                        padding:20px;
                        padding-left:30px;
                        @apply(--holding-fire-thanks-title); 
                    }

                    .thanks-section{
                        padding-top: 20px;
                        padding-left: 35px;
                        padding-right: 40px;
                        padding-bottom: 5px;
                        height: 100%;
                        padding: 20px;
                        @apply(--layout-vertical);
                        @apply(--layout-center);
                        @apply(--holding-fire-thanks-section);
                    }

                        .thanks-section a {
                            width: 100%;
                            text-decoration: none;
                            @apply(--holding-fire-twitter-link)
                        }

                        paper-button.twitter {
                            z-index: 400;
                            margin: auto;
                            width: 90%;
                            margin-left: 20px;
                            background-color:  #58aae8;
                            color: white;
                            height: 40px;
                            font-weight: bold;
                            font-size: 14px;
                            margin-top: 20px;
                            margin-bottom: 20px;
                            text-transform: capitalize;
                            @apply(--holding-fire-twitter-button); 
                        }
                        .twitter-icon {
                            @apply(--holding-fire-twitter-icon); 
                        }
    .noselect {
        -webkit-touch-callout: none; 
        -webkit-user-select: none; 
        -khtml-user-select: none; 
        -moz-user-select: none; 
        -ms-user-select: none; 
        user-select: none; 
    }

    @apply(--holding-fire-animations);

    </style>

    <firebase-document
        id="doc"
        app-name="[[appName]]"
        path="[[path]]"
        data="{{data}}">
    </firebase-document>
      <iron-media-query query="(max-width: 600px)" query-matches="{{smallScreen}}"></iron-media-query>
     
    <div class="overlay"></div>
    <div class="container">
        <img src="[[logo]]" class="logo" sizing="contain" alt="[[alt]]]">
        <div class="inner-container">
            <div class="content"> <slot></slot></div>
            <template is="dom-if" if="{{!subscribed}}" class="hidden">
                <div class="subscribe-container">
                        <div class="subscribe-title noselect">[[subHeader]]</div> 
                        <div class="subscribe-form">
                            <template is="dom-if" if="{{!noName}}">
                                <paper-input label="Name" class="custom" id="name" required error-message="Please enter your name" on-keydown="_catchEnter"></paper-input></br>    
                            </template>
                            <paper-input label="Email address" class="custom" id="email" type="email" required error-message="Please enter a valid email address" on-keydown="_catchEnter"></paper-input></br>            
                            <paper-button raised="[[!flatButtons]]" class="subscribe" on-tap="subscribe">[[subButton]]</paper-button>
                            <p class="email"><a href="mailto:[[email]]">[[email]]</a></p>
                        </div>
                </div>
            </template>


            <template is="dom-if" if="{{subscribed}}"> 
                <div class="thanks-container">
                    <div class="thanks-title noselect">[[thanksHeader]]</div>
                    <div class="thanks-section">
                        <p class="thanks-message noselect">[[thanks]]</p>
                        <template is="dom-if" if="{{twitter}}">
                            <a href$="https://twitter.com/[[twitter]]" target="_blank" tabindex="-1" class="button">
                                <paper-button raised="[[!flatButtons]]" class="twitter">
                                    <svg viewBox="0 0 20.34 16.17" style="height:15px;fill:#FFF; padding-left: 10px; padding-right: 10px" class="twitter-icon">
                                    <path class="515a544b-2ee6-4052-8329-f9002443fb0f" d="M7,16.61A11.39,11.39,0,0,0,18.43,5.14q0-.26,0-0.52a8.2,8.2,0,0,0,2-2.09,8,8,0,0,1-2.31.63A4,4,0,0,0,19.89.94a8.08,8.08,0,0,1-2.56,1,4,4,0,0,0-6.87,3.68A11.44,11.44,0,0,1,2.15,1.38,4,4,0,0,0,3.4,6.76a4,4,0,0,1-1.83-.5s0,0,0,.05a4,4,0,0,0,3.23,4A4,4,0,0,1,3,10.33a4,4,0,0,0,3.77,2.8,8.09,8.09,0,0,1-5,1.73,8.19,8.19,0,0,1-1-.06A11.41,11.41,0,0,0,7,16.61" transform="translate(-0.36 -0.55)"/>
                                    </svg>Follow us on Twitter
                                </paper-button>
                            </a>
                        </template>
                    </div>
                </div>
            </template>
        </div>

    </div>
</template>

  <script>
    Polymer({
    is: 'holding-fire',
    properties: {
        /**
        * Link to the image file for the logo
        *
        * @type {String}
        */
        logo: {
          type: String,
        },
        /**
        * Value denotes if the user is on a small screen
        *
        * @type {Boolean}
        */
        smallScreen: {
          type: Boolean,
          observer: '_smallScreen'
        },
        /**
        * Text to be displayed below the logo
        *
        * @type {String}
        */
        text: {
          type: String,
        },
        /**
        * Text to be displayed to thank the user
        *
        * @type {String}
        */
        thanks: {
          type: String,
        },
        /** 
        * Header text for thanks section 
        * 
        * @type {String} 
        */ 
        thanksHeader: { 
            type: String, 
            value: "THANKS FOR SUBSCRIBING" 
        }, 
        /**
        * Email to be displayed below the subscription form 
        *
        * @type {String}
        */
        email: {
          type: String,
        },
        /**
        * The name of the firebase app
        *
        * @type {String}
        */
        appName: {
          type: String,
        },
        /**
        * The storage path for the subscription emails 
        *
        * @type {String}
        */
        path: {
          type: String,
        },
        /**
        * Indicates if the user has subscribed 
        *
        * @type {Boolean}
        */
        subscribed: {
            type: Boolean,
            value: false,
        },
        /**
        * Alt text for the logo
        *
        * @type {String}
        */
        alt: {
            type: String,
        },
        /** 
        * Header text for subscription section 
        * 
        * @type {String} 
        */ 
        subHeader: { 
            type: String, 
            value: "BE THE FIRST TO KNOW" 
        }, 
        /** 
        * Button text for subscription section 
        * 
        * @type {String} 
        */ 
        subButton: { 
            type: String, 
            value: "Subscribe" 
        }, 

        /** 
        * Whether to ask for name or not 
        * 
        * @type {Boolean} 
        */ 
        noName: { 
            type: Boolean, 
            value: false
        },

        /** 
        * Whether to use flat buttons
        * 
        * @type {Boolean} 
        */ 
        flatButtons: { 
            type: Boolean, 
            value: false
        },
      },

    _smallScreen: function(){
        if (this.smallScreen){
            this.customStyle['--mobile-border'] = '5px';
            this.updateStyles();
        } else {
            this.customStyle['--mobile-border'] = '50px';
            this.updateStyles();
        }

    },
    subscribe: function(){
        e = this.$$("#email").validate()
        n = true;
        if(!this.noName){
            n = this.$$("#name").validate()
        }
        if( n && e ){
            var date = new Date();
            var epoch = date.getTime();
            var obj = {
                email: this.$$("#email").value,
                date: epoch
            }
            if(!this.noName){
                obj.name = this.$$("#name").value;
            }
            this.$.doc.ref.push(obj);
            this.subscribed = true;
        }
    },

    _catchEnter: function(e){
        if (e.keyCode ===13){
            this.subscribe();
        }
    }

    });
  </script>
</dom-module>
